\hypertarget{StruttureDati_8c}{\section{Riferimenti per il file Server/\+Strutture\+Dati.c}
\label{StruttureDati_8c}\index{Server/\+Strutture\+Dati.\+c@{Server/\+Strutture\+Dati.\+c}}
}


Contiene funzioni utilizzate per caricare il file di configurazione.  


{\ttfamily \#include $<$stdio.\+h$>$}\\*
{\ttfamily \#include $<$string.\+h$>$}\\*
{\ttfamily \#include $<$stdlib.\+h$>$}\\*
{\ttfamily \#include $<$assert.\+h$>$}\\*
{\ttfamily \#include $<$unistd.\+h$>$}\\*
{\ttfamily \#include $<$sys/mman.\+h$>$}\\*
{\ttfamily \#include $<$sys/types.\+h$>$}\\*
{\ttfamily \#include $<$semaphore.\+h$>$}\\*
{\ttfamily \#include $<$sys/wait.\+h$>$}\\*
{\ttfamily \#include $<$sys/socket.\+h$>$}\\*
{\ttfamily \#include $<$pthread.\+h$>$}\\*
{\ttfamily \#include \char`\"{}inc/\+Heartbeating.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}inc/\+Config.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}inc/\+Utils.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}inc/\+Strutture\+Dati.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}inc/\+O\+P\+E.\+h\char`\"{}}\\*
\subsection*{Funzioni}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{StruttureDati_8c_a12dc3ffb088dc6be12e6d5d2ed911031}{append\+Opened\+File} (char $\ast$nome\+File, int modo, \hyperlink{structOpenedFile}{Opened\+File} $\ast$$\ast$id)
\begin{DoxyCompactList}\small\item\em Aggiunge l' oggetto in input alla fine della lista linkata dei file aperti \hyperlink{structOpenedFile}{Opened\+File}. \end{DoxyCompactList}\item 
int \hyperlink{StruttureDati_8c_aa089645f4772b1d34f2808e1f913eb45}{check\+Modo\+Open} (char $\ast$nome\+File, int modo)
\begin{DoxyCompactList}\small\item\em controlla se la open è realizzabile con il modo richiesti \end{DoxyCompactList}\item 
int \hyperlink{StruttureDati_8c_a53729d51218aa9a03ba46e8b1fa89875}{file\+Already\+Opened\+In\+Write} (char $\ast$filename)
\begin{DoxyCompactList}\small\item\em Controlla se un file con quel nome e' gia' stato aperto in una modalita' che non permette l'accesso da parte di altri client N\+O\+T\+A\+: S\+I\+N\+C\+R\+O\+N\+I\+Z\+Z\+A\+T\+O C\+O\+N M\+U\+T\+E\+X. \end{DoxyCompactList}\item 
int \hyperlink{StruttureDati_8c_a6e2594e56afc29e961a1797a0bd8d262}{is\+Modo\+Apertura} (int modo\+\_\+client, int modo)
\begin{DoxyCompactList}\small\item\em Dice se modo\+\_\+client contiene il modo \char`\"{}modo\char`\"{}. \end{DoxyCompactList}\item 
void \hyperlink{StruttureDati_8c_a1b93a1e03b27ca80768a152cebb0fed3}{close\+Opened\+File} (unsigned long int ptid)
\begin{DoxyCompactList}\small\item\em Rimuove il nodo openedfile associato al ptid. \end{DoxyCompactList}\item 
void \hyperlink{StruttureDati_8c_a1674324a5bfcb0d5c3a5547c23a73e5a}{free\+Opened\+File} (\hyperlink{structOpenedFile}{Opened\+File} $\ast$id)
\begin{DoxyCompactList}\small\item\em Libera lo spazio occupato dal puntatore. \end{DoxyCompactList}\item 
void \hyperlink{StruttureDati_8c_a4d533448d4fea33fea1475cffe4ad377}{close\+Client\+Session} (unsigned long int ptid)
\begin{DoxyCompactList}\small\item\em rimuove collegamenti tra client e file aperti nella sessione N\+O\+T\+A\+: A\+C\+C\+E\+S\+S\+O S\+I\+N\+C\+R\+O\+N\+I\+Z\+Z\+A\+T\+O C\+O\+N M\+U\+T\+E\+X \end{DoxyCompactList}\item 
int \hyperlink{StruttureDati_8c_ab227c35b76ef6706729ad091f99e7263}{get\+Transfer\+Socket} ()
\item 
char $\ast$ \hyperlink{StruttureDati_8c_a5bd53dd113398b8df28c065f0ef2255e}{get\+File\+Name} ()
\begin{DoxyCompactList}\small\item\em Ritorna il nome del file aperto da questo ptid. \end{DoxyCompactList}\item 
\hyperlink{structOpenedFile}{Opened\+File} $\ast$ \hyperlink{StruttureDati_8c_a47a975b11b2dad0a1142c7313a7d2f19}{get\+Opened\+File} ()
\begin{DoxyCompactList}\small\item\em Ritorna l' opened file associato a questo ptid. \end{DoxyCompactList}\item 
int \hyperlink{StruttureDati_8c_ae45ca2477d989c728fe47566c9f5b95a}{count\+Opened\+File} ()
\begin{DoxyCompactList}\small\item\em Ritorna il numero di righe della tabella con i file aperti. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variabili}
\begin{DoxyCompactItemize}
\item 
\hyperlink{structOpenedFile}{Opened\+File} $\ast$$\ast$ \hyperlink{StruttureDati_8c_ac6c781406efae2362705c3a19a96474a}{opened\+File\+Linked\+List} = N\+U\+L\+L
\item 
\hyperlink{structOpenedFile}{Opened\+File} $\ast$$\ast$ \hyperlink{StruttureDati_8c_a7ed27afe1793bab93e0646228dd26ce3}{free\+\_\+head}
\item 
pthread\+\_\+mutex\+\_\+t $\ast$ \hyperlink{StruttureDati_8c_a8647861982974418fd65cf3dca69c54e}{mutex}
\begin{DoxyCompactList}\small\item\em Questo mutex e' da usare su ogni lavoro che si esegue con la lista linkata di elementi. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Descrizione dettagliata}
Contiene funzioni utilizzate per caricare il file di configurazione. 

Contiene le funzioni di utilita' per le Strutture Dati.

\begin{DoxyAuthor}{Autore}
Federico Ponzi 
\end{DoxyAuthor}
\begin{DoxyDate}{Data}
18.\+07.\+2015
\end{DoxyDate}
\begin{DoxyAuthor}{Autore}
Federico Ponzi 
\end{DoxyAuthor}
\begin{DoxyDate}{Data}
11.\+07.\+2015 
\end{DoxyDate}
\begin{DoxyRefDesc}{Da fare}
\item[\hyperlink{todo__todo000010}{Da fare}]Una struttura dati che contenga una lista di sockets 

Remove e add di una socket nella lista di sockets, remove di un file dalla lista di file aperti. N\+O\+T\+A\+: Ricordarsi di eseguire una free() dei Opened\+File-\/$>$file\+Name perchè viene allocata con una malloc in \hyperlink{OPE_8c}{O\+P\+E.\+c}\end{DoxyRefDesc}


Contiene tutte le funzioni utili per lavorare con le strutture dati definite nell' header di questo modulo. 

\subsection{Documentazione delle funzioni}
\hypertarget{StruttureDati_8c_a12dc3ffb088dc6be12e6d5d2ed911031}{\index{Strutture\+Dati.\+c@{Strutture\+Dati.\+c}!append\+Opened\+File@{append\+Opened\+File}}
\index{append\+Opened\+File@{append\+Opened\+File}!Strutture\+Dati.\+c@{Strutture\+Dati.\+c}}
\subsubsection[{append\+Opened\+File}]{\setlength{\rightskip}{0pt plus 5cm}int append\+Opened\+File (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{nome\+File, }
\item[{int}]{modo, }
\item[{{\bf Opened\+File} $\ast$$\ast$}]{id}
\end{DoxyParamCaption}
)}}\label{StruttureDati_8c_a12dc3ffb088dc6be12e6d5d2ed911031}


Aggiunge l' oggetto in input alla fine della lista linkata dei file aperti \hyperlink{structOpenedFile}{Opened\+File}. 

Se non esiste la radice main\+File la crea. Altrimenti scorre tutti i nodi fino ad arrivare all' elemento in coda, crea un nuovo nodo con i dati in input e lo appende alla fine. 

Referenzia check\+Modo\+Open(), Opened\+File\+::control\+Socket\+Mutex, file\+Already\+Opened\+In\+Write(), Opened\+File\+::file\+Name, Opened\+File\+::fp, free\+\_\+head, getptid(), is\+Modo\+Apertura(), log\+M(), Opened\+File\+::modo, mutex, my\+Exit(), M\+Y\+O\+\_\+\+C\+R\+E\+A\+T, M\+Y\+O\+\_\+\+T\+R\+U\+N\+C, Opened\+File\+::next, number\+Alive\+Childs, opened\+File\+Linked\+List, Opened\+File\+::ptid, e root\+Path.



Referenziato da handle\+Open\+Command().

\hypertarget{StruttureDati_8c_aa089645f4772b1d34f2808e1f913eb45}{\index{Strutture\+Dati.\+c@{Strutture\+Dati.\+c}!check\+Modo\+Open@{check\+Modo\+Open}}
\index{check\+Modo\+Open@{check\+Modo\+Open}!Strutture\+Dati.\+c@{Strutture\+Dati.\+c}}
\subsubsection[{check\+Modo\+Open}]{\setlength{\rightskip}{0pt plus 5cm}int check\+Modo\+Open (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{nome\+File, }
\item[{int}]{modo}
\end{DoxyParamCaption}
)}}\label{StruttureDati_8c_aa089645f4772b1d34f2808e1f913eb45}


controlla se la open è realizzabile con il modo richiesti 



Referenzia Opened\+File\+::file\+Name, is\+Modo\+Apertura(), log\+M(), Opened\+File\+::modo, mutex, M\+Y\+O\+\_\+\+C\+R\+E\+A\+T, M\+Y\+O\+\_\+\+E\+X\+C\+L, M\+Y\+O\+\_\+\+E\+X\+L\+O\+C\+K, M\+Y\+O\+\_\+\+R\+D\+W\+R, M\+Y\+O\+\_\+\+W\+R\+O\+N\+L\+Y, Opened\+File\+::next, opened\+File\+Linked\+List, e root\+Path.



Referenziato da append\+Opened\+File().

\hypertarget{StruttureDati_8c_a4d533448d4fea33fea1475cffe4ad377}{\index{Strutture\+Dati.\+c@{Strutture\+Dati.\+c}!close\+Client\+Session@{close\+Client\+Session}}
\index{close\+Client\+Session@{close\+Client\+Session}!Strutture\+Dati.\+c@{Strutture\+Dati.\+c}}
\subsubsection[{close\+Client\+Session}]{\setlength{\rightskip}{0pt plus 5cm}void close\+Client\+Session (
\begin{DoxyParamCaption}
\item[{unsigned long int}]{ptid}
\end{DoxyParamCaption}
)}}\label{StruttureDati_8c_a4d533448d4fea33fea1475cffe4ad377}


rimuove collegamenti tra client e file aperti nella sessione N\+O\+T\+A\+: A\+C\+C\+E\+S\+S\+O S\+I\+N\+C\+R\+O\+N\+I\+Z\+Z\+A\+T\+O C\+O\+N M\+U\+T\+E\+X 


\begin{DoxyParams}{Parametri}
{\em int} & sd socket descriptor del client \\
\hline
\end{DoxyParams}


Referenzia count\+Opened\+File(), Opened\+File\+::file\+Name, free\+\_\+head, free\+Opened\+File(), log\+M(), mutex, Opened\+File\+::next, opened\+File\+Linked\+List, Opened\+File\+::ptid, e T\+R\+U\+E.



Referenziato da handle\+Close\+Command(), handle\+Open\+Command(), handle\+R\+E\+A\+D\+Command(), handle\+Socket(), e heart\+Beat().

\hypertarget{StruttureDati_8c_a1b93a1e03b27ca80768a152cebb0fed3}{\index{Strutture\+Dati.\+c@{Strutture\+Dati.\+c}!close\+Opened\+File@{close\+Opened\+File}}
\index{close\+Opened\+File@{close\+Opened\+File}!Strutture\+Dati.\+c@{Strutture\+Dati.\+c}}
\subsubsection[{close\+Opened\+File}]{\setlength{\rightskip}{0pt plus 5cm}void close\+Opened\+File (
\begin{DoxyParamCaption}
\item[{unsigned long int}]{ptid}
\end{DoxyParamCaption}
)}}\label{StruttureDati_8c_a1b93a1e03b27ca80768a152cebb0fed3}


Rimuove il nodo openedfile associato al ptid. 

\begin{DoxyRefDesc}{Da fare}
\item[\hyperlink{todo__todo000011}{Da fare}]da fare. \end{DoxyRefDesc}
\hypertarget{StruttureDati_8c_ae45ca2477d989c728fe47566c9f5b95a}{\index{Strutture\+Dati.\+c@{Strutture\+Dati.\+c}!count\+Opened\+File@{count\+Opened\+File}}
\index{count\+Opened\+File@{count\+Opened\+File}!Strutture\+Dati.\+c@{Strutture\+Dati.\+c}}
\subsubsection[{count\+Opened\+File}]{\setlength{\rightskip}{0pt plus 5cm}int count\+Opened\+File (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{StruttureDati_8c_ae45ca2477d989c728fe47566c9f5b95a}


Ritorna il numero di righe della tabella con i file aperti. 



Referenzia mutex, Opened\+File\+::next, e opened\+File\+Linked\+List.



Referenziato da close\+Client\+Session().

\hypertarget{StruttureDati_8c_a53729d51218aa9a03ba46e8b1fa89875}{\index{Strutture\+Dati.\+c@{Strutture\+Dati.\+c}!file\+Already\+Opened\+In\+Write@{file\+Already\+Opened\+In\+Write}}
\index{file\+Already\+Opened\+In\+Write@{file\+Already\+Opened\+In\+Write}!Strutture\+Dati.\+c@{Strutture\+Dati.\+c}}
\subsubsection[{file\+Already\+Opened\+In\+Write}]{\setlength{\rightskip}{0pt plus 5cm}int file\+Already\+Opened\+In\+Write (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{filename}
\end{DoxyParamCaption}
)}}\label{StruttureDati_8c_a53729d51218aa9a03ba46e8b1fa89875}


Controlla se un file con quel nome e' gia' stato aperto in una modalita' che non permette l'accesso da parte di altri client N\+O\+T\+A\+: S\+I\+N\+C\+R\+O\+N\+I\+Z\+Z\+A\+T\+O C\+O\+N M\+U\+T\+E\+X. 



Referenzia F\+A\+L\+S\+E, Opened\+File\+::file\+Name, is\+Modo\+Apertura(), log\+M(), Opened\+File\+::modo, mutex, M\+Y\+O\+\_\+\+E\+X\+L\+O\+C\+K, M\+Y\+O\+\_\+\+R\+D\+W\+R, M\+Y\+O\+\_\+\+W\+R\+O\+N\+L\+Y, Opened\+File\+::next, e opened\+File\+Linked\+List.



Referenziato da append\+Opened\+File().

\hypertarget{StruttureDati_8c_a1674324a5bfcb0d5c3a5547c23a73e5a}{\index{Strutture\+Dati.\+c@{Strutture\+Dati.\+c}!free\+Opened\+File@{free\+Opened\+File}}
\index{free\+Opened\+File@{free\+Opened\+File}!Strutture\+Dati.\+c@{Strutture\+Dati.\+c}}
\subsubsection[{free\+Opened\+File}]{\setlength{\rightskip}{0pt plus 5cm}void free\+Opened\+File (
\begin{DoxyParamCaption}
\item[{{\bf Opened\+File} $\ast$}]{id}
\end{DoxyParamCaption}
)}}\label{StruttureDati_8c_a1674324a5bfcb0d5c3a5547c23a73e5a}


Libera lo spazio occupato dal puntatore. 

\begin{DoxyRefDesc}{Da fare}
\item[\hyperlink{todo__todo000012}{Da fare}]da finire. \end{DoxyRefDesc}


Referenzia Opened\+File\+::control\+Socket\+Id, Opened\+File\+::fp, log\+M(), e Opened\+File\+::transfer\+Socket\+Id.



Referenziato da close\+Client\+Session().

\hypertarget{StruttureDati_8c_a5bd53dd113398b8df28c065f0ef2255e}{\index{Strutture\+Dati.\+c@{Strutture\+Dati.\+c}!get\+File\+Name@{get\+File\+Name}}
\index{get\+File\+Name@{get\+File\+Name}!Strutture\+Dati.\+c@{Strutture\+Dati.\+c}}
\subsubsection[{get\+File\+Name}]{\setlength{\rightskip}{0pt plus 5cm}char$\ast$ get\+File\+Name (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{StruttureDati_8c_a5bd53dd113398b8df28c065f0ef2255e}


Ritorna il nome del file aperto da questo ptid. 

N\+O\+T\+A\+: A\+C\+C\+E\+S\+S\+O S\+I\+N\+C\+R\+O\+N\+I\+Z\+Z\+A\+T\+O C\+O\+N M\+U\+T\+E\+X 

Referenzia Opened\+File\+::file\+Name, getptid(), mutex, Opened\+File\+::next, opened\+File\+Linked\+List, e Opened\+File\+::ptid.

\hypertarget{StruttureDati_8c_a47a975b11b2dad0a1142c7313a7d2f19}{\index{Strutture\+Dati.\+c@{Strutture\+Dati.\+c}!get\+Opened\+File@{get\+Opened\+File}}
\index{get\+Opened\+File@{get\+Opened\+File}!Strutture\+Dati.\+c@{Strutture\+Dati.\+c}}
\subsubsection[{get\+Opened\+File}]{\setlength{\rightskip}{0pt plus 5cm}{\bf Opened\+File}$\ast$ get\+Opened\+File (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{StruttureDati_8c_a47a975b11b2dad0a1142c7313a7d2f19}


Ritorna l' opened file associato a questo ptid. 



Referenzia getptid(), mutex, Opened\+File\+::next, opened\+File\+Linked\+List, e Opened\+File\+::ptid.



Referenziato da handle\+Close\+Command(), handle\+R\+E\+A\+D\+Command(), e sig\+\_\+handler().

\hypertarget{StruttureDati_8c_ab227c35b76ef6706729ad091f99e7263}{\index{Strutture\+Dati.\+c@{Strutture\+Dati.\+c}!get\+Transfer\+Socket@{get\+Transfer\+Socket}}
\index{get\+Transfer\+Socket@{get\+Transfer\+Socket}!Strutture\+Dati.\+c@{Strutture\+Dati.\+c}}
\subsubsection[{get\+Transfer\+Socket}]{\setlength{\rightskip}{0pt plus 5cm}int get\+Transfer\+Socket (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{StruttureDati_8c_ab227c35b76ef6706729ad091f99e7263}


Referenzia Opened\+File\+::control\+Socket\+Id, getptid(), mutex, Opened\+File\+::next, opened\+File\+Linked\+List, e Opened\+File\+::ptid.

\hypertarget{StruttureDati_8c_a6e2594e56afc29e961a1797a0bd8d262}{\index{Strutture\+Dati.\+c@{Strutture\+Dati.\+c}!is\+Modo\+Apertura@{is\+Modo\+Apertura}}
\index{is\+Modo\+Apertura@{is\+Modo\+Apertura}!Strutture\+Dati.\+c@{Strutture\+Dati.\+c}}
\subsubsection[{is\+Modo\+Apertura}]{\setlength{\rightskip}{0pt plus 5cm}int is\+Modo\+Apertura (
\begin{DoxyParamCaption}
\item[{int}]{modo\+\_\+client, }
\item[{int}]{modo}
\end{DoxyParamCaption}
)}}\label{StruttureDati_8c_a6e2594e56afc29e961a1797a0bd8d262}


Dice se modo\+\_\+client contiene il modo \char`\"{}modo\char`\"{}. 



Referenzia F\+A\+L\+S\+E, e T\+R\+U\+E.



Referenziato da append\+Opened\+File(), check\+Modo\+Open(), file\+Already\+Opened\+In\+Write(), handle\+Close\+Command(), handle\+Open\+Command(), e mydfs\+\_\+write().



\subsection{Documentazione delle variabili}
\hypertarget{StruttureDati_8c_a7ed27afe1793bab93e0646228dd26ce3}{\index{Strutture\+Dati.\+c@{Strutture\+Dati.\+c}!free\+\_\+head@{free\+\_\+head}}
\index{free\+\_\+head@{free\+\_\+head}!Strutture\+Dati.\+c@{Strutture\+Dati.\+c}}
\subsubsection[{free\+\_\+head}]{\setlength{\rightskip}{0pt plus 5cm}{\bf Opened\+File}$\ast$$\ast$ free\+\_\+head}}\label{StruttureDati_8c_a7ed27afe1793bab93e0646228dd26ce3}


Referenziato da append\+Opened\+File(), e close\+Client\+Session().

\hypertarget{StruttureDati_8c_a8647861982974418fd65cf3dca69c54e}{\index{Strutture\+Dati.\+c@{Strutture\+Dati.\+c}!mutex@{mutex}}
\index{mutex@{mutex}!Strutture\+Dati.\+c@{Strutture\+Dati.\+c}}
\subsubsection[{mutex}]{\setlength{\rightskip}{0pt plus 5cm}pthread\+\_\+mutex\+\_\+t$\ast$ mutex}}\label{StruttureDati_8c_a8647861982974418fd65cf3dca69c54e}


Questo mutex e' da usare su ogni lavoro che si esegue con la lista linkata di elementi. 



Referenziato da append\+Opened\+File(), check\+Modo\+Open(), close\+Client\+Session(), count\+Opened\+File(), file\+Already\+Opened\+In\+Write(), get\+File\+Name(), get\+Opened\+File(), get\+Transfer\+Socket(), e send\+Invalidate().

\hypertarget{StruttureDati_8c_ac6c781406efae2362705c3a19a96474a}{\index{Strutture\+Dati.\+c@{Strutture\+Dati.\+c}!opened\+File\+Linked\+List@{opened\+File\+Linked\+List}}
\index{opened\+File\+Linked\+List@{opened\+File\+Linked\+List}!Strutture\+Dati.\+c@{Strutture\+Dati.\+c}}
\subsubsection[{opened\+File\+Linked\+List}]{\setlength{\rightskip}{0pt plus 5cm}{\bf Opened\+File}$\ast$$\ast$ opened\+File\+Linked\+List = N\+U\+L\+L}}\label{StruttureDati_8c_ac6c781406efae2362705c3a19a96474a}


Referenziato da append\+Opened\+File(), check\+Modo\+Open(), close\+Client\+Session(), count\+Opened\+File(), file\+Already\+Opened\+In\+Write(), get\+File\+Name(), get\+Opened\+File(), get\+Transfer\+Socket(), e send\+Invalidate().

